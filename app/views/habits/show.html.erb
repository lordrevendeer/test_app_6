<h1 class="text-center">Showing habit details</h1>

<h2 class="text-center mt-4"><%= @habit.title %></h2>
<div class="container">
        <div class="row justify-content-md-center">
            <div class="col-8 mt-4">
            <div class="card text-center shadow mb-5 bg-white rounded">
                <div class="card-header font-italic">
                   <%= @habit.user.username %>
                   <%= link_to gravatar_for(@habit.user), user_path(@habit.user) %>
                </div>
                <div class="card-body">
                <p class="card-text"><div class="card-text text-center"><%= simple_format(@habit.description) %></div></p>
                <p class="card-text"><div class="card-text text-center">Frequency: <%= (@habit.frequency) %></div></p>
                <% if logged_in? && (@habit.user == current_user || current_user.admin?) %>
                <%= link_to "Edit", edit_habit_path(@habit), class: "btn btn-outline-info" %>
                <%= link_to "Delete", habit_path(@habit), class: "btn btn-outline-danger", method: :delete, data: {confirm: "Are you sure?"} %>
                <% end %>
                </div>
                <div class="card-footer text-muted">
                <small >Created <%= time_ago_in_words(@habit.created_at) %> ago,
                edited <%= time_ago_in_words(@habit.updated_at) %> ago</small>
                </div>
            </div>
            </div>  
        </div> 

        <div class="dropdown">
            <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Have you completed the task today?
            </a>

            <div class="dropdown-menu center" aria-labelledby="dropdownMenuLink">
                <a class="dropdown-item" href="<%= render 'yes', obj: @habit %>">Yes</a>
                <a class="dropdown-item" href="<%= render 'no', obj: @habit %>">No</a>
            </div>
        </div>        
</div>

<% t = 0 %>
<% s = 0 %>
<% d = 0 %>
<% m = 0 %>
<% y = 0 %>

<% if @habit.frequency == "Daily" %>
    <% Stat.all.each do |stat| %>
      <% s=s+1 if stat.habit_id == @habit.id && stat.done == true %>
      <% t=t+1 if stat.habit_id == @habit.id  %>
    <% end %>
<% end %>

<% if @habit.frequency == "Weekly" %>
    <% counter = 0 %>
    <% Stat.all.each do |stat| %>
      <% s=s+1 if stat.habit_id == @habit.id && stat.done == true %>
      <% t=t+1 if stat.habit_id == @habit.id  %>
    <% end %>
<% end %>

<% if @habit.frequency == "Monthly" %>
    <% prev = "0" %>
    <% Stat.all.each do |stat| %>
      <% s=s+1 if ((stat.habit_id == @habit.id )&& (stat.dates.strftime("%m") != prev))%>
      <% t=t+1 if (stat.dates.strftime("%m") != prev)%>
    <% end %>
<% end %>

<%= pie_chart(yes:s, no:t-s) %>



